<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <title>BabylonJS VR Test (Playground)</title>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body style="margin:0;overflow:hidden">
  <div id="canvasZone" style="position:relative;width:100vw;height:100vh">
    <canvas id="renderCanvas" style="width:100%;height:100%;touch-action:none"></canvas>
    <button id="enlargeButton"
      style="position:absolute;right:10px;bottom:10px;width:48px;height:48px;
             background:url('https://cdn-icons-png.freepik.com/256/17460/17460854.png') no-repeat center;
             background-size:contain;border:none;cursor:pointer;z-index:9999">
    </button>
  </div>

  <script>
    const canvas = document.getElementById("renderCanvas");
    const canvasParent = document.getElementById("canvasZone");
    const enlargeButton = document.getElementById("enlargeButton");
    const engine = new BABYLON.Engine(canvas, true);

    let sensorPermissionGranted = false;
    let vrMode = false;
    let freeCamera, vrCamera, scene;

    const createScene = function () {
      scene = new BABYLON.Scene(engine);

      freeCamera = new BABYLON.FreeCamera("freeCam", new BABYLON.Vector3(0, 1.6, -10), scene);
      freeCamera.setTarget(new BABYLON.Vector3(0, 1.6, 0));
      freeCamera.attachControl(canvas, true);

      vrCamera = new BABYLON.VRDeviceOrientationFreeCamera("vrCam", new BABYLON.Vector3(0, 1.6, -10), scene);
      vrCamera.setTarget(new BABYLON.Vector3(0, 1.6, 0));

      const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
      light.intensity = 0.7;

      BABYLON.MeshBuilder.CreateSphere("sphere", { diameter: 2 }, scene).position.y = 1;
      BABYLON.MeshBuilder.CreateGround("ground", { width: 10, height: 10 }, scene);

      return scene;
    };

    enlargeButton.onclick = async function () {
      if (BABYLON.Engine.IsIOS && !sensorPermissionGranted) {
        try {
          if (typeof DeviceOrientationEvent !== 'undefined' &&
              typeof DeviceOrientationEvent.requestPermission === 'function') {
            const permission = await DeviceOrientationEvent.requestPermission();
            if (permission === 'granted') {
              sensorPermissionGranted = true;
            } else {
              alert("Sensör izni reddedildi.");
              return;
            }
          }
        } catch (err) {
          console.error("Sensör izni hatası:", err);
          return;
        }
      }

      if (!vrMode) {
        await canvasParent.requestFullscreen();
        freeCamera.detachControl(canvas);
        vrCamera.attachControl(canvas, true);
        scene.activeCamera = vrCamera;
        vrMode = true;
      } else {
        await document.exitFullscreen();
        vrCamera.detachControl(canvas);
        freeCamera.attachControl(canvas, true);
        scene.activeCamera = freeCamera;
        vrMode = false;
      }
    };

    document.addEventListener("fullscreenchange", () => {
      vrMode = !!document.fullscreenElement;
      enlargeButton.style.backgroundImage = vrMode
        ? "url('https://cdn-icons-png.freepik.com/256/18672/18672116.png')"
        : "url('https://cdn-icons-png.freepik.com/256/17460/17460854.png')";
    });

    scene = createScene();
    engine.runRenderLoop(() => scene.render());
    window.addEventListener("resize", () => engine.resize());
  </script>
</body>
</html>
